<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Your Cart</h1>

      <table class="table table-bordered table-hover" id="table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody id="cart-container"></tbody>
      </table>
    </div>

    <script>
        debugger;
        async function fun() {
            const url = 'https://localhost:44330/api/CartIItem/GetToCart'
            var data = await fetch(url);
            var response = await data.json();

            var table =  document.getElementById("table");

            response.forEach(element => {
                table.innerHTML += 
               ` <tbody>
                    <tr>
                       <td>${element.product.productName}</td>
                       <td>${element.cartId}</td>
                       <td>${element.quantity}</td>
                       <button type="button" class="btn btn-outline-danger" onclick="clearCart()">Clear</button>
                        </tr>
                    </tbody>
                `
            });
        }
        fun();
        function clearCart() {
        }
    </script>
  </body>
</html>
 -->


 <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Your Cart</h1>

      <table class="table table-bordered table-hover" id="table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="cart-container"></tbody>
      </table>
    </div>

    <script>
        async function fun() {
            const url = 'https://localhost:44330/api/CartIItem/GetToCart'
            var data = await fetch(url);
            var response = await data.json();

            var table = document.getElementById("cart-container");

            response.forEach(element => {
                table.innerHTML += 
                `<tr id="row-${element.product.productId}">
                    <td>${element.product.productName}</td>
                    <td>${element.product.price}</td>
                    <td>
                        <input type="number" id="quantity-${element.product.productId}" value="${element.quantity}" min="1" class="form-control"/>
                    </td>
                    <td>
                        <button class="btn btn-primary" onclick="editItem(${element.product.productId})">Edit</button>
                        <button class="btn btn-danger" onclick="clearCart(${element.product.productId})">Clear</button>
                    </td>
                </tr>`;
            });
        }

        fun();

        // Function to Edit Item (Update Quantity)
        async function editItem(productId) {
            const urlUpdate = 'https://localhost:44330/api/CartIItem/UpdateCartItem';
            var newQuantity = document.getElementById(`quantity-${productId}`).value;
            
            var response = await fetch(urlUpdate, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    cartId: localStorage.cartId,
                    productId: productId,
                    quantity: newQuantity
                })
            });

            alert("Quantity updated successfully!");
        }

        // Function to Clear (Delete) Item from Cart
        async function clearCart(productId) {
            const urlDelete = `https://localhost:44330/api/CartIItem/DeleteCartItem?productId=${productId}`;
            
            var response = await fetch(urlDelete, {
                method: 'DELETE'
            });

            // Remove the product row from the UI
            document.getElementById(`row-${productId}`).remove();

            alert("Item removed successfully!");
        }
    </script>
  </body>
</html>
